<!doctype html><html lang=ja-jp><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.85.0"><title>LINE上で手軽に割り勘できるサービスを作った - 1ミリもわからん</title><link rel=canonical href=https://raahii.github.io/posts/haraiai-line/><link href=https://raahii.github.io/favicon.ico rel=icon type=image/x-icon><meta property="description" content="LINE上で手軽に割り勘できるサービスを作った"><meta property="keywords" content="個人開発"><meta property="og:title" content="LINE上で手軽に割り勘できるサービスを作った"><meta property="og:description" content="LINE上で手軽に割り勘できるサービスを作った"><meta property="og:type" content="article"><meta property="og:url" content="https://raahii.github.io/posts/haraiai-line/"><meta property="og:image" content="https://raahii.github.io/images/2022/haraiai-line/ogp.png"><meta property="article:section" content="post"><meta property="article:published_time" content="2022-07-10T11:50:00+09:00"><meta property="article:modified_time" content="2022-07-10T11:50:00+09:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://raahii.github.io/images/2022/haraiai-line/ogp.png"><meta name=twitter:title content="LINE上で手軽に割り勘できるサービスを作った"><meta name=twitter:description content="LINE上で手軽に割り勘できるサービスを作った"><link rel=icon href=https://raahii.github.io/images/favicon.ico type=image/x-icon><link rel=stylesheet href=https://raahii.github.io/css/main.css media=all><link rel=stylesheet href="//fonts.googleapis.com/css?family=Merriweather:400|Lato:400,400italic,700"></head><body><div class=wrapper><header class=header><nav class=nav><a href=https://raahii.github.io/ class=nav-logo><img src=https://raahii.github.io/images/bird.svg width=45 height=45 alt=Logo><p class=nav-title>1ミリもわからん</p></a><ul class=nav-links><li><a href=/tags/>Tags</a></li><li><a href=/about/>About</a></li><li><a href=https://github.com/raahii target=_blank>GitHub</a></li><li><a href=https://twitter.com/raahiiy target=_blank>Twitter</a></li></ul></nav></header><main class=content role=main><article class=article><h1 class=article-title>LINE上で手軽に割り勘できるサービスを作った</h1><span class=article-date>July 10, 2022</span>
<span class=article-duration>1 min read</span><ul class="cp_tag01 article-categories">Categories:<li><a href=/categories/%E9%96%8B%E7%99%BA/>開発</a></li></ul><ul class="cp_tag01 article-tags">Tags:<li><a href=/tags/%E5%80%8B%E4%BA%BA%E9%96%8B%E7%99%BA/>個人開発</a></li><li><a href=/tags/line-bot/>LINE Bot</a></li><li><a href=/tags/gcp/>GCP</a></li></ul><div class=article-content><div style=text-align:center><figure style="margin:30px 0"><a class=dont-hightlight href=https://haraiai.netlify.app target=_blank><img loading=lazy src=/images/2022/haraiai-line/haraiai-logo.png alt="haraiai icon" width=300px></a><figcaption></figcaption></figure></div><p>LINE 上で手軽に割り勘できる <a href=https://haraiai.netlify.app/>haraiai - 払い合い</a> というサービスを作った。</p><p>ターゲットユーザーとして主にカップルを想定しているが、2人組であれば誰でも使えるサービスで、こんな価値仮設を基に開発した。</p><div class=highlight><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>(ユーザー)    カップルなどの2人組は、
(欲求)       支払いをどちらかがまとめてした際に、割り勘を記録したいが、
(課題)       わざわざアプリを入れたりするのは面倒くさいので、
(製品の特徴)  LINE上で手軽に支払いを記録できることに価値がある
</code></pre></div><h2 id=使い方>使い方</h2><p><a href=https://line.me/R/ti/p/@560mkygn>hairai 公式アカウント</a> を友達に追加してグループを作成し、そこで支払いを記録していくだけでOK。</p><div style=text-align:center><figure style="margin:30px 0"><img loading=lazy src=/images/2022/haraiai-line/how-to-record-payment.png alt=支払いを記録するデモ width=70%><figcaption></figcaption></figure></div><p>「集計」とメッセージを送ると、支出の差額を割り勘した結果を返す。</p><div style=text-align:center><figure style="margin:30px 0"><img loading=lazy src=/images/2022/haraiai-line/how-to-total-up.png alt=集計を表示するデモ width=70%><figcaption></figcaption></figure></div><p>haraiai 公式アカウントは「メッセージが2行」かつ「2行目が金額（数値）」であるメッセージだけを支出と判断して処理する。よって普通の会話は自由にできるつくりになっている。</p><h2 id=開発のきっかけ>開発のきっかけ</h2><p>個人的にパートナーと同棲を始めるにあたって、まとめて支払ったものを楽に記録・精算できる方法を探していた。</p><p>よくあるやり方として共通の財布やカードを作るというものがあるが、準備に時間と手間がかかる。加えて、支払い方法が多様化している今、「個人のお金」と「共通のお金」を分けること自体が面倒だと感じていた。</p><p>そこで共通化することはさっぱりと諦めて、互いに支払いを記録していくととした。</p><p>いくつか既存のアプリも試したが、<strong>普段から使っている LINE 上で記録できるツールを自作することにした</strong>。そのほうが</p><ul><li>アプリケーションのインストールが要らず、使い方も迷わない</li><li>LINE は日常的に開くのでシームレスに記録できる</li><li>普通の会話もできる、記録が会話につながる</li></ul><p>という良さがあった。</p><p>デメリットを一つ上げるなら、手で入力するのが手間、ということだ。たしかに大量の支払いがあるならマッチしないかもしれない。</p><p>でも自分はむしろ、この手で入力する行為が「支出を記録しない」という選択肢を残してくれており、自由度の高さにつながっていると感じる。</p><p>例えば、「さっきの支払いは奢りね」というやり取りがあれば、記録しなければよい。「食費は自分の方が多く食べるから多めに負担するね」となれば、好きな額を差し引いて記録すれば良い。<strong>このような柔軟性は共通口座にはない haraiai の強みと考えている</strong>。</p><p>ということで、プロトタイプ <sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup> をブラッシュアップして公開することにした。</p><h2 id=精算はどうやるの>精算はどうやるの？</h2><p>一つ、さきほどの使い方の項で触れなかった操作がある。それが「精算」だ。支払いの不均衡を解消するために月末にやる人が多いと思う。</p><p>実は haraiai でも「精算」と呼びかけることでできる。だが、あえてサービス説明などでは載せておらず、 <strong>支払いの少ない側が次回払うようにしてバランスを取る</strong> ことをおすすめしている。</p><p>理由は、どちらかがまとめて払っている時点で、一時的に多く払っている状況は許容できるケースが多いと思うからだ。プロトタイプを使う中でも、シーソーゲームのように支払いのバランスを調整していくことで、精算はなくても良いと感じた。</p><p>不要なことに時間を使うのはもったいないので、是非、払い合ってほしいという思いを込めてサービス名をこのようにした。haraiai では自然と精算を回避するように設計されている。</p><h2 id=運用コストの話>運用コストの話</h2><p>haraiai は <a href=https://developers.line.biz/ja/services/messaging-api/>LINE Bot</a> なので、LINE上でメッセージ送信などのイベントが起こった際に送られてくる webhook event の処理が主となる。今回はコストを最低限に抑えることを考えて、 GCP の Cloud Functions と Firestore Database を使った。</p><p>Cloud Functions は 200万リクエスト/月 までは無料。1グループあたり月100メッセージ飛んでくるとしても、月2万グループまでは無料で運用できる。</p><p>Database の方は読み取りと書き込み、保存データ量でそれぞれ無料枠の基準が設定されている。haraiai は最低限のグループ情報と各ユーザーの支払総額を保持しているだけなので、グループあたりのデータサイズは小さくて済む。1グループのデータが1KBと仮定すると、</p><ul><li>毎日5万件のwebhookの受信 (read)</li><li>毎日2万件の割り勘 (write)</li><li>10万グループの永続化</li></ul><p>が無料でできる。やはり月間2万LINEグループくらいが目安になりそうなので、ほぼ無料で運用できる見通しだ。</p><p>懸念点としては、LINEのメッセージが送られるたびに webhook を受信せざるをえないので、スタ爆みたいなことをやられると辛い。今はすべてのリクエストでグループ情報を read しているので、Function も Database も使われてしまう。</p><p>よって今後の対策として、関係のない会話など、処理する必要のないイベントはDBアクセスをスキップさせることを考えている。</p><p>LINE プラットフォーム側にもユーザーごとのリクエスト制限機能などがあると良いのになとは思うが…。</p><p>ちなみにGWに個人開発のコストの話が盛り上がっていて、これらの記事は面白かった。</p><ul><li><a href=https://k0kubun.hatenablog.com/entry/surplus>個人開発を黒字にする技術 - k0kubun&rsquo;s blog</a></li><li><a href=https://laiso.hatenablog.com/entry/nope-sql>個人開発のコストはDB次第 - laiso</a></li><li><a href=https://anond.hatelabo.jp/20220504211823>個人でWEB開発を１５年くらいやってる者ですが</a></li><li><a href=https://sue445.hatenablog.com/entry/2022/05/06/170001>なるべくお金をかけずに個人アプリを運用したい - くりにっき</a></li></ul><p>今回は FaaS や terraform 使ってみたいという技術的な興味でこの構成だが、もっとヘビーなものをつくるんだったら、Heroku や VPS のような固定費用のものが堅実だろうと思う。個人開発でいきなりスケーラビリティが必要なことなんてまぁないと思うので。</p><div style=text-align:center><figure style="margin:30px 0"><a class=dont-hightlight href=https://github.com/pocket-dan/haraiai target=_blank><img loading=lazy src=https://gh-card.dev/repos/pocket-dan/haraiai.svg alt="Github Repo" width=60%></a><figcaption></figcaption></figure></div><h2 id=終わりに>終わりに</h2><p>今のところ、「haraiai」と検索しても 「harai<strong>t</strong>ai」の検索結果になってしまうので、まずはこれを打破したいorz</p><div style=text-align:center><figure style="margin:30px 0"><a class=dont-hightlight href="https://www.google.com/search?q=haraiai" target=_blank><img loading=lazy src=/images/2022/haraiai-line/google-search-omg-result.png alt=悲しいGoogle検索結果 width=100%></a><figcaption></figcaption></figure></div><p>是非、触ってみてほしい！🙌 <a href=https://haraiai.netlify.app/>haraiai - 払い合い</a></p><section class=footnotes role=doc-endnotes><hr><ol><li id=fn:1 role=doc-endnote><p>haraiai の試作品&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></section></div></article><div id=disqus_thread></div><script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return}var b=document,a=b.createElement('script');a.async=!0,a.src='//raahii.disqus.com/embed.js',a.setAttribute('data-timestamp',+new Date),(b.head||b.body).appendChild(a)})()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></main><footer class=footer><ul class=footer-links><li><a href=https://gohugo.io/ class=footer-links-kudos>Made with <img src=https://raahii.github.io/images/hugo-logo.png width=22 height=22 alt="hugo log"></a></li></ul></footer></div><script async src="https://www.googletagmanager.com/gtag/js?id=G-D4N0KPT2K2"></script><script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-D4N0KPT2K2',{anonymize_ip:!1})}</script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.10.1/dist/katex.min.css integrity=sha384-dbVIfZGuN1Yq7/1Ocstc1lUEm+AT+/rCkibIcC/OmWo5f0EA48Vf8CytHzGrSwbQ crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.10.1/dist/katex.min.js integrity=sha384-2BKqo+exmr9su6dir+qCw08N2ZKRucY4PrGQPPWU1A7FtlCGjmEGFqXCv5nyM5Ij crossorigin=anonymous></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.10.1/dist/contrib/auto-render.min.js integrity=sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI crossorigin=anonymous onload=renderMathInElement(document.body)></script><script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}]})})</script></body></html>